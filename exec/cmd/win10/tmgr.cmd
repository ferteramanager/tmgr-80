: ======================================================================================================================
: -- TeraManager Executive Driver --------------------------------------------------------------------------------------
: ======================================================================================================================

  @echo off

  setlocal

: -- At least one parameter required -----------------------------------------------------------------------------------

  if "%1" == "" goto showSyntax

: -- Global Settings ---------------------------------------------------------------------------------------------------

  set TMDISK=D:
  set TMHOME=%TMDISK%\tmgr
  set TMDATA=%TMHOME%\data
  set TMEXEC=%TMHOME%\exec
  set TMSOFT=%TMHOME%\soft
  set TMPATH=%TMEXEC%\cmd

: -- PATH Extension ----------------------------------------------------------------------------------------------------

  set PATH=%TMPATH%;%PATH%
  
: -- Server Settings ---------------------------------------------------------------------------------------------------
  
  set TMHOST=10.101.187.103
  set TMPORT=5000
  set TMSTOP=5001
  set TMPROD=TMGR 8.0 Server

: -- Java Settings -----------------------------------------------------------------------------------------------------

  set TMJAVA=%TMSOFT%\java\jre-10.0.2\bin\java
  set TMKRNL=%TMEXEC%\jar\tmgr-8.0-kernel.jar

: -- User Settings -----------------------------------------------------------------------------------------------------

  set TMCMDS=%TMEXEC%\cmd
  set TMSQLR=%TMEXEC%\sql
  set TMINST=%TMDATA%\Test80
  set TMPRFL=%TMCMDS%\knight.cfg
  set TMLOGS=%TMINST%\_inst\logs
  set TMBOOK=%TMLOGS%\tmgr80.log
  set TMEDIT=-editschema=D:\tmgr\data1\schema.txt
  set TMOPTS=-listing=on -trace=on -debuglevel=9

: -- Dispatcher --------------------------------------------------------------------------------------------------------

:run

  set TMLIST=admin start stop create windows client
  for %%F in (%TMLIST%) do if /I "%1" == "%%F" goto run%1

: -- Missing Arguments -------------------------------------------------------------------------------------------------

:showSyntax

  set LIST={ admin ! start ! stop ! create ! client ! windows }
  echo.
  echo Syntax: %~n0 %LIST% [options] [sqlfiles]
  echo.
  goto :eof

: ----------------------------------------------------------------------------------------------------------------------
: -- Creates Instance --------------------------------------------------------------------------------------------------
: ----------------------------------------------------------------------------------------------------------------------

:runAdmin

  call :runProgram tmgr.TeraManager -admin -server %TMSQLR%\100.createInstance.sql
  goto :eof

: ----------------------------------------------------------------------------------------------------------------------
: -- Start -------------------------------------------------------------------------------------------------------------
: ----------------------------------------------------------------------------------------------------------------------

:runStart

  if /I "%1" == "start" (
    start "%TMPROD%" /MIN /HIGH %TMJAVA% -cp %TMKRNL% tmgr.TeraManager -start=%TMINST% %TMEDIT% %TMOPTS% >%TMBOOK%
  )
  goto :eof

: ----------------------------------------------------------------------------------------------------------------------
: -- Stop --------------------------------------------------------------------------------------------------------------
: ----------------------------------------------------------------------------------------------------------------------

:runStop

  if /I "%1" == "stop" (
    call :runProgram tmgr.TeraManager -server -stop
  )
  goto :eof

: ----------------------------------------------------------------------------------------------------------------------
: -- Creates Infrastructure --------------------------------------------------------------------------------------------
: ----------------------------------------------------------------------------------------------------------------------

:runCreate

  call :runProgram tmgr.work.TeraClient %TMSQLR%\101.createSchema.sql
  call :runProgram tmgr.work.TeraClient %TMSQLR%\200.createTelco.sql
: call :runProgram tmgr.work.TeraClient %TMSQLR%\210.createCells.sql
: call :runProgram tmgr.work.TeraClient %TMSQLR%\230.createVoice.sql
: call :runProgram tmgr.work.TeraClient %TMSQLR%\240.createShort.sql
  goto :eof

: ----------------------------------------------------------------------------------------------------------------------
: -- Client ------------------------------------------------------------------------------------------------------------
: ----------------------------------------------------------------------------------------------------------------------

:runClient

  call :runProgram tmgr.work.TeraClient %2 %3 %4 %5 %6 %7 %8 %9
  goto :eof

: ----------------------------------------------------------------------------------------------------------------------
: -- Windows -----------------------------------------------------------------------------------------------------------
: ----------------------------------------------------------------------------------------------------------------------

:runWindows

  call :runProgram tmgr.form.TeraGraphics
  goto :eof

: ======================================================================================================================
: -- Any TeraManager Program -------------------------------------------------------------------------------------------
: ======================================================================================================================

:runProgram

  pushd %TMJARS%
  %TMJAVA% -cp %TMKRNL% %1 -profile=%TMPRFL% %2 %3 %4 %5 %6 %7 %8 %9
  popd

: -- End of Job --------------------------------------------------------------------------------------------------------

:done

  endlocal
